// Code generated by goa v3.14.1, DO NOT EDIT.
//
// storage gRPC server types
//
// Command:
// $ goa gen goa.design/examples/cellar/design

package server

import (
	"unicode/utf8"

	storagepb "goa.design/examples/cellar/gen/grpc/storage/pb"
	storage "goa.design/examples/cellar/gen/storage"
	storageviews "goa.design/examples/cellar/gen/storage/views"
	goa "goa.design/goa/v3/pkg"
)

// NewProtoStoredBottleCollection builds the gRPC response type from the result
// of the "list" endpoint of the "storage" service.
func NewProtoStoredBottleCollection(result storageviews.StoredBottleCollectionView) *storagepb.StoredBottleCollection {
	message := &storagepb.StoredBottleCollection{}
	message.Field = make([]*storagepb.StoredBottle, len(result))
	for i, val := range result {
		message.Field[i] = &storagepb.StoredBottle{
			Id:          *val.ID,
			Name:        *val.Name,
			Vintage:     *val.Vintage,
			Description: val.Description,
			Rating:      val.Rating,
		}
		if val.Winery != nil {
			message.Field[i].Winery = svcStorageviewsWineryViewToStoragepbWinery(val.Winery)
		}
		if val.Composition != nil {
			message.Field[i].Composition = make([]*storagepb.Component, len(val.Composition))
			for j, val := range val.Composition {
				message.Field[i].Composition[j] = &storagepb.Component{
					Varietal:   *val.Varietal,
					Percentage: val.Percentage,
				}
			}
		}
	}
	return message
}

// NewShowPayload builds the payload of the "show" endpoint of the "storage"
// service from the gRPC request type.
func NewShowPayload(message *storagepb.ShowRequest, view *string) *storage.ShowPayload {
	v := &storage.ShowPayload{
		ID: message.Id,
	}
	v.View = view
	return v
}

// NewProtoShowResponse builds the gRPC response type from the result of the
// "show" endpoint of the "storage" service.
func NewProtoShowResponse(result *storageviews.StoredBottleView) *storagepb.ShowResponse {
	message := &storagepb.ShowResponse{
		Id:          *result.ID,
		Name:        *result.Name,
		Vintage:     *result.Vintage,
		Description: result.Description,
		Rating:      result.Rating,
	}
	if result.Winery != nil {
		message.Winery = svcStorageviewsWineryViewToStoragepbWinery(result.Winery)
	}
	if result.Composition != nil {
		message.Composition = make([]*storagepb.Component, len(result.Composition))
		for i, val := range result.Composition {
			message.Composition[i] = &storagepb.Component{
				Varietal:   *val.Varietal,
				Percentage: val.Percentage,
			}
		}
	}
	return message
}

// NewShowNotFoundError builds the gRPC error response type from the error of
// the "show" endpoint of the "storage" service.
func NewShowNotFoundError(er *storage.NotFound) *storagepb.ShowNotFoundError {
	message := &storagepb.ShowNotFoundError{
		Message_: er.Message,
		Id:       er.ID,
	}
	return message
}

// NewAddPayload builds the payload of the "add" endpoint of the "storage"
// service from the gRPC request type.
func NewAddPayload(message *storagepb.AddRequest) *storage.Bottle {
	v := &storage.Bottle{
		Name:        message.Name,
		Vintage:     message.Vintage,
		Description: message.Description,
		Rating:      message.Rating,
	}
	if message.Winery != nil {
		v.Winery = protobufStoragepbWineryToStorageWinery(message.Winery)
	}
	if message.Composition != nil {
		v.Composition = make([]*storage.Component, len(message.Composition))
		for i, val := range message.Composition {
			v.Composition[i] = &storage.Component{
				Varietal:   val.Varietal,
				Percentage: val.Percentage,
			}
		}
	}
	return v
}

// NewProtoAddResponse builds the gRPC response type from the result of the
// "add" endpoint of the "storage" service.
func NewProtoAddResponse(result string) *storagepb.AddResponse {
	message := &storagepb.AddResponse{}
	message.Field = result
	return message
}

// NewRemovePayload builds the payload of the "remove" endpoint of the
// "storage" service from the gRPC request type.
func NewRemovePayload(message *storagepb.RemoveRequest) *storage.RemovePayload {
	v := &storage.RemovePayload{
		ID: message.Id,
	}
	return v
}

// NewProtoRemoveResponse builds the gRPC response type from the result of the
// "remove" endpoint of the "storage" service.
func NewProtoRemoveResponse() *storagepb.RemoveResponse {
	message := &storagepb.RemoveResponse{}
	return message
}

// NewRatePayload builds the payload of the "rate" endpoint of the "storage"
// service from the gRPC request type.
func NewRatePayload(message *storagepb.RateRequest) map[uint32][]string {
	v := make(map[uint32][]string, len(message.Field))
	for key, val := range message.Field {
		tk := key
		tv := make([]string, len(val.Field))
		for i, val := range val.Field {
			tv[i] = val
		}
		v[tk] = tv
	}
	return v
}

// NewProtoRateResponse builds the gRPC response type from the result of the
// "rate" endpoint of the "storage" service.
func NewProtoRateResponse() *storagepb.RateResponse {
	message := &storagepb.RateResponse{}
	return message
}

// NewMultiAddPayload builds the payload of the "multi_add" endpoint of the
// "storage" service from the gRPC request type.
func NewMultiAddPayload(message *storagepb.MultiAddRequest) []*storage.Bottle {
	v := make([]*storage.Bottle, len(message.Field))
	for i, val := range message.Field {
		v[i] = &storage.Bottle{
			Name:        val.Name,
			Vintage:     val.Vintage,
			Description: val.Description,
			Rating:      val.Rating,
		}
		if val.Winery != nil {
			v[i].Winery = protobufStoragepbWineryToStorageWinery(val.Winery)
		}
		if val.Composition != nil {
			v[i].Composition = make([]*storage.Component, len(val.Composition))
			for j, val := range val.Composition {
				v[i].Composition[j] = &storage.Component{
					Varietal:   val.Varietal,
					Percentage: val.Percentage,
				}
			}
		}
	}
	return v
}

// NewProtoMultiAddResponse builds the gRPC response type from the result of
// the "multi_add" endpoint of the "storage" service.
func NewProtoMultiAddResponse(result []string) *storagepb.MultiAddResponse {
	message := &storagepb.MultiAddResponse{}
	message.Field = make([]string, len(result))
	for i, val := range result {
		message.Field[i] = val
	}
	return message
}

// NewMultiUpdatePayload builds the payload of the "multi_update" endpoint of
// the "storage" service from the gRPC request type.
func NewMultiUpdatePayload(message *storagepb.MultiUpdateRequest) *storage.MultiUpdatePayload {
	v := &storage.MultiUpdatePayload{}
	if message.Ids != nil {
		v.Ids = make([]string, len(message.Ids))
		for i, val := range message.Ids {
			v.Ids[i] = val
		}
	}
	if message.Bottles != nil {
		v.Bottles = make([]*storage.Bottle, len(message.Bottles))
		for i, val := range message.Bottles {
			v.Bottles[i] = &storage.Bottle{
				Name:        val.Name,
				Vintage:     val.Vintage,
				Description: val.Description,
				Rating:      val.Rating,
			}
			if val.Winery != nil {
				v.Bottles[i].Winery = protobufStoragepbWineryToStorageWinery(val.Winery)
			}
			if val.Composition != nil {
				v.Bottles[i].Composition = make([]*storage.Component, len(val.Composition))
				for j, val := range val.Composition {
					v.Bottles[i].Composition[j] = &storage.Component{
						Varietal:   val.Varietal,
						Percentage: val.Percentage,
					}
				}
			}
		}
	}
	return v
}

// NewProtoMultiUpdateResponse builds the gRPC response type from the result of
// the "multi_update" endpoint of the "storage" service.
func NewProtoMultiUpdateResponse() *storagepb.MultiUpdateResponse {
	message := &storagepb.MultiUpdateResponse{}
	return message
}

// ValidateWinery runs the validations defined on Winery.
func ValidateWinery(winery *storagepb.Winery) (err error) {
	err = goa.MergeErrors(err, goa.ValidatePattern("winery.region", winery.Region, "[a-zA-Z '\\.]+"))
	err = goa.MergeErrors(err, goa.ValidatePattern("winery.country", winery.Country, "[a-zA-Z '\\.]+"))
	if winery.Url != nil {
		err = goa.MergeErrors(err, goa.ValidatePattern("winery.url", *winery.Url, "^(https?|ftp)://[^\\s/$.?#].[^\\s]*$"))
	}
	return
}

// ValidateComponent runs the validations defined on Component.
func ValidateComponent(elem *storagepb.Component) (err error) {
	err = goa.MergeErrors(err, goa.ValidatePattern("elem.varietal", elem.Varietal, "[A-Za-z' ]+"))
	if utf8.RuneCountInString(elem.Varietal) > 100 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("elem.varietal", elem.Varietal, utf8.RuneCountInString(elem.Varietal), 100, false))
	}
	if elem.Percentage != nil {
		if *elem.Percentage < 1 {
			err = goa.MergeErrors(err, goa.InvalidRangeError("elem.percentage", *elem.Percentage, 1, true))
		}
	}
	if elem.Percentage != nil {
		if *elem.Percentage > 100 {
			err = goa.MergeErrors(err, goa.InvalidRangeError("elem.percentage", *elem.Percentage, 100, false))
		}
	}
	return
}

// ValidateAddRequest runs the validations defined on AddRequest.
func ValidateAddRequest(message *storagepb.AddRequest) (err error) {
	if message.Winery == nil {
		err = goa.MergeErrors(err, goa.MissingFieldError("winery", "message"))
	}
	if utf8.RuneCountInString(message.Name) > 100 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.name", message.Name, utf8.RuneCountInString(message.Name), 100, false))
	}
	if message.Winery != nil {
		if err2 := ValidateWinery(message.Winery); err2 != nil {
			err = goa.MergeErrors(err, err2)
		}
	}
	if message.Vintage < 1900 {
		err = goa.MergeErrors(err, goa.InvalidRangeError("message.vintage", message.Vintage, 1900, true))
	}
	if message.Vintage > 2020 {
		err = goa.MergeErrors(err, goa.InvalidRangeError("message.vintage", message.Vintage, 2020, false))
	}
	for _, e := range message.Composition {
		if e != nil {
			if err2 := ValidateComponent(e); err2 != nil {
				err = goa.MergeErrors(err, err2)
			}
		}
	}
	if message.Description != nil {
		if utf8.RuneCountInString(*message.Description) > 2000 {
			err = goa.MergeErrors(err, goa.InvalidLengthError("message.description", *message.Description, utf8.RuneCountInString(*message.Description), 2000, false))
		}
	}
	if message.Rating != nil {
		if *message.Rating < 1 {
			err = goa.MergeErrors(err, goa.InvalidRangeError("message.rating", *message.Rating, 1, true))
		}
	}
	if message.Rating != nil {
		if *message.Rating > 5 {
			err = goa.MergeErrors(err, goa.InvalidRangeError("message.rating", *message.Rating, 5, false))
		}
	}
	return
}

// ValidateRateRequest runs the validations defined on RateRequest.
func ValidateRateRequest(message *storagepb.RateRequest) (err error) {
	for _, v := range message.Field {
		if v != nil {
			if err2 := ValidateArrayOfString(v); err2 != nil {
				err = goa.MergeErrors(err, err2)
			}
		}
	}
	return
}

// ValidateArrayOfString runs the validations defined on ArrayOfString.
func ValidateArrayOfString(val *storagepb.ArrayOfString) (err error) {
	if val.Field == nil {
		err = goa.MergeErrors(err, goa.MissingFieldError("field", "val"))
	}
	return
}

// ValidateMultiAddRequest runs the validations defined on MultiAddRequest.
func ValidateMultiAddRequest(message *storagepb.MultiAddRequest) (err error) {
	for _, e := range message.Field {
		if e != nil {
			if err2 := ValidateBottle(e); err2 != nil {
				err = goa.MergeErrors(err, err2)
			}
		}
	}
	return
}

// ValidateBottle runs the validations defined on Bottle.
func ValidateBottle(elem *storagepb.Bottle) (err error) {
	if elem.Winery == nil {
		err = goa.MergeErrors(err, goa.MissingFieldError("winery", "elem"))
	}
	if utf8.RuneCountInString(elem.Name) > 100 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("elem.name", elem.Name, utf8.RuneCountInString(elem.Name), 100, false))
	}
	if elem.Winery != nil {
		if err2 := ValidateWinery(elem.Winery); err2 != nil {
			err = goa.MergeErrors(err, err2)
		}
	}
	if elem.Vintage < 1900 {
		err = goa.MergeErrors(err, goa.InvalidRangeError("elem.vintage", elem.Vintage, 1900, true))
	}
	if elem.Vintage > 2020 {
		err = goa.MergeErrors(err, goa.InvalidRangeError("elem.vintage", elem.Vintage, 2020, false))
	}
	for _, e := range elem.Composition {
		if e != nil {
			if err2 := ValidateComponent(e); err2 != nil {
				err = goa.MergeErrors(err, err2)
			}
		}
	}
	if elem.Description != nil {
		if utf8.RuneCountInString(*elem.Description) > 2000 {
			err = goa.MergeErrors(err, goa.InvalidLengthError("elem.description", *elem.Description, utf8.RuneCountInString(*elem.Description), 2000, false))
		}
	}
	if elem.Rating != nil {
		if *elem.Rating < 1 {
			err = goa.MergeErrors(err, goa.InvalidRangeError("elem.rating", *elem.Rating, 1, true))
		}
	}
	if elem.Rating != nil {
		if *elem.Rating > 5 {
			err = goa.MergeErrors(err, goa.InvalidRangeError("elem.rating", *elem.Rating, 5, false))
		}
	}
	return
}

// ValidateMultiUpdateRequest runs the validations defined on
// MultiUpdateRequest.
func ValidateMultiUpdateRequest(message *storagepb.MultiUpdateRequest) (err error) {
	if message.Ids == nil {
		err = goa.MergeErrors(err, goa.MissingFieldError("ids", "message"))
	}
	if message.Bottles == nil {
		err = goa.MergeErrors(err, goa.MissingFieldError("bottles", "message"))
	}
	for _, e := range message.Bottles {
		if e != nil {
			if err2 := ValidateBottle(e); err2 != nil {
				err = goa.MergeErrors(err, err2)
			}
		}
	}
	return
}

// svcStorageviewsWineryViewToStoragepbWinery builds a value of type
// *storagepb.Winery from a value of type *storageviews.WineryView.
func svcStorageviewsWineryViewToStoragepbWinery(v *storageviews.WineryView) *storagepb.Winery {
	res := &storagepb.Winery{
		Name:    *v.Name,
		Region:  *v.Region,
		Country: *v.Country,
		Url:     v.URL,
	}

	return res
}

// protobufStoragepbWineryToStorageviewsWineryView builds a value of type
// *storageviews.WineryView from a value of type *storagepb.Winery.
func protobufStoragepbWineryToStorageviewsWineryView(v *storagepb.Winery) *storageviews.WineryView {
	res := &storageviews.WineryView{
		Name:    &v.Name,
		Region:  &v.Region,
		Country: &v.Country,
		URL:     v.Url,
	}

	return res
}

// protobufStoragepbWineryToStorageWinery builds a value of type
// *storage.Winery from a value of type *storagepb.Winery.
func protobufStoragepbWineryToStorageWinery(v *storagepb.Winery) *storage.Winery {
	res := &storage.Winery{
		Name:    v.Name,
		Region:  v.Region,
		Country: v.Country,
		URL:     v.Url,
	}

	return res
}

// svcStorageWineryToStoragepbWinery builds a value of type *storagepb.Winery
// from a value of type *storage.Winery.
func svcStorageWineryToStoragepbWinery(v *storage.Winery) *storagepb.Winery {
	res := &storagepb.Winery{
		Name:    v.Name,
		Region:  v.Region,
		Country: v.Country,
		Url:     v.URL,
	}

	return res
}
